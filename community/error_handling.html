<!---
  Licensed to the Apache Software Foundation (ASF) under one
  or more contributor license agreements.  See the NOTICE file
  distributed with this work for additional information
  regarding copyright ownership.  The ASF licenses this file
  to you under the Apache License, Version 2.0 (the
  "License"); you may not use this file except in compliance
  with the License.  You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing,
  software distributed under the License is distributed on an
  "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, either express or implied.  See the License for the
  specific language governing permissions and limitations
  under the License.
-->
---
layout: default
---
<script>

</script>
<article class="post">

    <header class="post-header wrapper">
        <h1 class="post-title">Error Handling Guide</h1>
        <h3>Utilize structured error types in MXNet for modern cross-language error handling.</h3><a style="float:left; margin-top:20px" href="/versions/master/community/index" class="btn btn-action">Contribute
            <span class="span-accented">›</span></a></header>

    <div class="post-content">
        <div class="wrapper">
            <!--- Licensed to the Apache Software Foundation (ASF) under one -->
<!--- or more contributor license agreements.  See the NOTICE file -->
<!--- distributed with this work for additional information -->
<!--- regarding copyright ownership.  The ASF licenses this file -->
<!--- to you under the Apache License, Version 2.0 (the -->
<!--- "License"); you may not use this file except in compliance -->
<!--- with the License.  You may obtain a copy of the License at -->

<!---   http://www.apache.org/licenses/LICENSE-2.0 -->

<!--- Unless required by applicable law or agreed to in writing, -->
<!--- software distributed under the License is distributed on an -->
<!--- "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY -->
<!--- KIND, either express or implied.  See the License for the -->
<!--- specific language governing permissions and limitations -->
<!--- under the License. -->

<h1 id="error-handling-guide">Error Handling Guide</h1>

<p>MXNet contains structured error classes to indicate specific types of
error. Please raise a specific error type when possible, so that users
can write code to handle a specific error category if necessary. You can
directly raise the specific error object in python. In other languages
like c++, you simply add <code class="highlighter-rouge">&lt;ErrorType&gt;:</code> prefix to the error message(see
below).</p>

<div class="alert alert-info" role="alert"><i class="fa fa-info-circle"></i> <b>Note:</b> Please refer to <a href="https://github.com/apache/incubator-mxnet/blob/master/python/mxnet/error.py">/python/mxnet/error.py</a> for the list of errors.</div>

<h2 id="raise-a-specific-error-in-c">Raise a Specific Error in C++</h2>

<p>You can add <code class="highlighter-rouge">&lt;ErrorType&gt;:</code> prefix to your error message to raise an
error of the corresponding type. Note that you do not have to add a new
type <code class="highlighter-rouge">mxnet.base.MXNetError</code> will be
raised by default when there is no error type prefix in the message.
This mechanism works for both <code class="highlighter-rouge">LOG(FATAL)</code> and <code class="highlighter-rouge">CHECK</code> macros. The
following code gives an example on how to do so.</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Python frontend receives the following error type:</span>
<span class="c1">// ValueError: Check failed: x == y (0 vs. 1) : expect x and y to be equal.</span>
<span class="n">CHECK_EQ</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">"ValueError: expect x and y to be equal."</span>


<span class="c1">// Python frontend receives the following error type:</span>
<span class="c1">// InternalError: cannot reach here</span>
<span class="n">LOG</span><span class="p">(</span><span class="n">FATAL</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">"InternalError: cannot reach here"</span><span class="p">;</span>
</code></pre></div></div>

<p>As you can see in the above example, MXNet’s ffi system combines both the
python and C++’s stacktrace into a single message, and generate the
corresponding error class automatically.</p>

<h2 id="how-to-choose-an-error-type">How to choose an Error Type</h2>

<p>You can go through the error types are listed below, try to use common
sense and also refer to the choices in the existing code. We try to keep
a reasonable amount of error types. If you feel there is a need to add a
new error type, do the following steps:</p>

<ul>
  <li>Send a RFC proposal with a description and usage examples in the
current codebase.</li>
  <li>Add the new error type to <code class="highlighter-rouge">mxnet.error</code> with clear documents.</li>
  <li>Update the list in this file to include the new error type.</li>
  <li>Change the code to use the new error type.</li>
</ul>

<p>We also recommend to use less abstraction when creating the short error
messages. The code is more readable in this way, and also opens path to
craft specific error messages when necessary.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">preferred</span><span class="p">():</span>
    <span class="c1"># Very clear about what is being raised and what is the error message.
</span>    <span class="k">raise</span> <span class="n">OpNotImplemented</span><span class="p">(</span><span class="s">"Operator relu is not implemented in the MXNet frontend"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_op_not_implemented</span><span class="p">(</span><span class="n">op_name</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">OpNotImplemented</span><span class="p">(</span><span class="s">"Operator {} is not implemented."</span><span class="p">)</span><span class="o">.</span><span class="nb">format</span><span class="p">(</span><span class="n">op_name</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">not_preferred</span><span class="p">():</span>
    <span class="c1"># Introduces another level of indirection.
</span>    <span class="k">raise</span> <span class="n">_op_not_implemented</span><span class="p">(</span><span class="s">"relu"</span><span class="p">)</span>
</code></pre></div></div>

<p>If we need to introduce a wrapper function that constructs multi-line
error messages, please put wrapper in the same file so other developers
can look up the implementation easily.</p>

<h2 id="signal-handling">Signal Handling</h2>

<p>When not careful, some errors can occur in the form of a <a href="https://en.wikipedia.org/wiki/Signal_(IPC)">signal</a>,
which is handled by the OS kernel. In MXNet, you can choose to handle certain signals in the form of
a catchable exception. This can be combined with the error type selection above so that it can be
caught in the Python frontend. Currently, the following signals are handled this way:</p>

<ul>
  <li><code class="highlighter-rouge">SIGFPE</code>: throws <code class="highlighter-rouge">FloatingPointError</code></li>
  <li><code class="highlighter-rouge">SIGBUS</code>: throws <code class="highlighter-rouge">IOError</code></li>
</ul>

<p>To extend this to other signals, you can modify the signal handler registration in
<a href="https://github.com/apache/incubator-mxnet/blob/72eff9b66ecc683c3e7f9ad2c0ba69efa8dd423b/src/initialize.cc#L347-L376">/src/initialize.cc</a>.</p>

<script async="" defer="" src="https://buttons.github.io/buttons.js"></script>

<script src="https://apis.google.com/js/platform.js"></script>


        </div>
    </div>

</article>
