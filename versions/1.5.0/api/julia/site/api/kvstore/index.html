
<!DOCTYPE doctype html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="ie=edge" http-equiv="x-ua-compatible"/>
<meta content="Copy to clipboard" name="lang:clipboard.copy"/>
<meta content="Copied to clipboard" name="lang:clipboard.copied"/>
<meta content="en" name="lang:search.language"/>
<meta content="True" name="lang:search.pipeline.stopwords"/>
<meta content="True" name="lang:search.pipeline.trimmer"/>
<meta content="No matching documents" name="lang:search.result.none"/>
<meta content="1 matching document" name="lang:search.result.one"/>
<meta content="# matching documents" name="lang:search.result.other"/>
<meta content="[\s\-]+" name="lang:search.tokenizer"/>
<link href="../../assets/images/favicon.png" rel="shortcut icon"/>
<meta content="mkdocs-1.0.4, mkdocs-material-4.4.2" name="generator"/>
<title>Kvstore - MXNet.jl</title>
<link href="../../assets/stylesheets/application.30686662.css" rel="stylesheet"/>
<script src="../../assets/javascripts/modernizr.74668098.js"></script>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&amp;display=fallback" rel="stylesheet"/>
<style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
<link href="../../assets/fonts/material-icons.css" rel="stylesheet"/>
<link href="../../assets/Documenter.css" rel="stylesheet"/>
</head>
<body dir="ltr">
<svg class="md-svg">
<defs>
<svg height="448" id="__github" viewbox="0 0 416 448" width="416" xmlns="http://www.w3.org/2000/svg"><path d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z" fill="currentColor"></path></svg>
</defs>
</svg>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<a class="md-skip" href="#key-value-store" tabindex="1">
        Skip to content
      </a>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a class="md-header-nav__button md-logo" href="../.." title="MXNet.jl">
<i class="md-icon"></i>
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
              MXNet.jl
            </span>
<span class="md-header-nav__topic">
              
                Kvstore
              
            </span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="query" data-md-state="active" name="query" placeholder="Search" spellcheck="false" type="text"/>
<label class="md-icon md-search__icon" for="__search"></label>
<button class="md-icon md-search__icon" data-md-component="reset" tabindex="-1" type="reset">
        
      </button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
            Type to start searching
          </div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<div class="md-header-nav__source">
<a class="md-source" data-md-source="github" href="https://github.com/dmlc/MXNet.jl/" title="Go to repository">
<div class="md-source__icon">
<svg height="24" viewbox="0 0 24 24" width="24">
<use height="24" width="24" xlink:href="#__github"></use>
</svg>
</div>
<div class="md-source__repository">
    GitHub
  </div>
</a>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container">
<main class="md-main" role="main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title md-nav__title--site" for="__drawer">
<a class="md-nav__button md-logo" href="../.." title="MXNet.jl">
<i class="md-icon"></i>
</a>
    MXNet.jl
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-source="github" href="https://github.com/dmlc/MXNet.jl/" title="Go to repository">
<div class="md-source__icon">
<svg height="24" viewbox="0 0 24 24" width="24">
<use height="24" width="24" xlink:href="#__github"></use>
</svg>
</div>
<div class="md-source__repository">
    GitHub
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../.." title="Home">
      Home
    </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" id="nav-2" type="checkbox"/>
<label class="md-nav__link" for="nav-2">
      Tutorial
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="1">
<label class="md-nav__title" for="nav-2">
        Tutorial
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../tutorial/mnist/" title="Digit Recognition on MNIST">
      Digit Recognition on MNIST
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../tutorial/char-lstm/" title="Generating Random Sentence with LSTM RNN">
      Generating Random Sentence with LSTM RNN
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" id="nav-3" type="checkbox"/>
<label class="md-nav__link" for="nav-3">
      User Guide
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="1">
<label class="md-nav__title" for="nav-3">
        User Guide
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../user-guide/install/" title="Installation Guide">
      Installation Guide
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../user-guide/overview/" title="Overview">
      Overview
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../user-guide/faq/" title="FAQ">
      FAQ
    </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" id="nav-4" type="checkbox"/>
<label class="md-nav__link" for="nav-4">
      API Documentation
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="1">
<label class="md-nav__title" for="nav-4">
        API Documentation
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../context/" title="Context">
      Context
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../model/" title="Models">
      Models
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../initializer/" title="Initializers">
      Initializers
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../optimizer/" title="Optimizers">
      Optimizers
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../callback/" title="Callbacks in training">
      Callbacks in training
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../metric/" title="Evaluation Metrics">
      Evaluation Metrics
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../io/" title="Data Providers">
      Data Providers
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../ndarray/" title="NDArray API">
      NDArray API
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../symbolic-node/" title="Symbolic API">
      Symbolic API
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../nn-factory/" title="Neural Networks Factory">
      Neural Networks Factory
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../executor/" title="Executor">
      Executor
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../visualize/" title="Network Visualization">
      Network Visualization
    </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
</nav>
</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<a class="md-icon md-content__icon" href="https://github.com/dmlc/MXNet.jl/edit/master/docs/api/kvstore.md" title="Edit this page"></a>
<!--–- Licensed to the Apache Software Foundation (ASF) under one –--> <!--–- or more contributor license agreements.  See the NOTICE file –--> <!--–- distributed with this work for additional information –--> <!--–- regarding copyright ownership.  The ASF licenses this file –--> <!--–- to you under the Apache License, Version 2.0 (the –--> <!--–- "License"); you may not use this file except in compliance –--> <!--–- with the License.  You may obtain a copy of the License at –-->
<!--–-   http://www.apache.org/licenses/LICENSE-2.0 –-->
<!--–- Unless required by applicable law or agreed to in writing, –--> <!--–- software distributed under the License is distributed on an –--> <!--–- "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY –--> <!--–- KIND, either express or implied.  See the License for the –--> <!--–- specific language governing permissions and limitations –--> <!--–- under the License. –-->
<p><a id="Key-Value-Store-1"></a></p>
<h1 id="key-value-store">Key-Value Store</h1>
<p><a href="#MXNet.mx.KVStore" id="MXNet.mx.KVStore">#</a>
<strong><code>MXNet.mx.KVStore</code></strong> — <em>Type</em>.</p>
<pre><code>KVStore(kv_type = :local)
</code></pre>
<p>For single machine training, there are two commonly used types:</p>
<ul>
<li><code>local</code>: Copies all gradients to CPU memory and updates weights there.</li>
<li><code>device</code>: Aggregates gradients and updates weights on GPU(s). With this setting, the <code>KVStore</code> also attempts to use GPU peer-to-peer communication, potentially accelerating the communication.</li>
</ul>
<p>For distributed training, <code>KVStore</code> also supports a number of types:</p>
<ul>
<li><code>dist_sync</code>: Behaves similarly to <code>local</code> but with one major difference. With <code>dist_sync</code>, batch-size now means the batch size used on each machine. So if there are <code>n</code> machines and we use batch size $b$, then <code>dist_sync</code> behaves like <code>local</code> with batch size <code>n * b</code>.</li>
<li><code>dist_device_sync</code>: Identical to <code>dist_sync</code> with the difference similar to <code>device</code> vs <code>local</code>.</li>
<li><code>dist_async</code>: Performs asynchronous updates. The weights are updated whenever gradients are received from any machine. No two updates happen on the same weight at the same time. However, the order is not guaranteed.</li>
</ul>
<p><a class="documenter-source" href="https://github.com/apache/incubator-mxnet/blob/c9818480680f84daa6e281a974ab263691302ba8/julia/src/kvstore.jl#L20-L45" target="_blank">source</a><br/></p>
<p><a href="#MXNet.mx.barrier-Tuple{KVStore}" id="MXNet.mx.barrier-Tuple{KVStore}">#</a>
<strong><code>MXNet.mx.barrier</code></strong> — <em>Method</em>.</p>
<pre><code>barrier(kv::KVStore)
</code></pre>
<p>Invokes global barrier among all worker nodes.</p>
<p>For example, assume there are <code>n</code> machines. We would like machine <code>0</code> to first <code>init</code> the values and then have all the workers <code>pull</code> the initialized value. Before pulling, we can place invoke <code>barrier(kv)</code> to guarantee that the initialization is finished.</p>
<p><a class="documenter-source" href="https://github.com/apache/incubator-mxnet/blob/c9818480680f84daa6e281a974ab263691302ba8/julia/src/kvstore.jl#L237-L246" target="_blank">source</a><br/></p>
<p><a href="#MXNet.mx.init!-Tuple{KVStore,Int64,NDArray}" id="MXNet.mx.init!-Tuple{KVStore,Int64,NDArray}">#</a>
<strong><code>MXNet.mx.init!</code></strong> — <em>Method</em>.</p>
<pre><code>init!(kv::KVStore, key::Int, val::NDArray)
init!(kv::KVStore, keys, vals)
</code></pre>
<p>Initializes a single or a sequence of key-value pairs into the store.</p>
<p>For each key, one must <code>init!</code> it before calling <code>push!</code> or <code>pull!</code>. When multiple workers invoke <code>init!</code> for the same key, only the value supplied by worker with rank <code>0</code> is used. This function returns after data has been initialized successfully.</p>
<pre><code class="julia-repl">julia&gt; kv = KVStore(:local)
mx.KVStore @ local

julia&gt; init!(kv, 42, mx.rand(2, 3))
</code></pre>
<p><a class="documenter-source" href="https://github.com/apache/incubator-mxnet/blob/c9818480680f84daa6e281a974ab263691302ba8/julia/src/kvstore.jl#L80-L97" target="_blank">source</a><br/></p>
<p><a href="#MXNet.mx.pull!-Tuple{KVStore,Int64,NDArray}" id="MXNet.mx.pull!-Tuple{KVStore,Int64,NDArray}">#</a>
<strong><code>MXNet.mx.pull!</code></strong> — <em>Method</em>.</p>
<p>Pulls a single value or a sequence of values from the store.</p>
<p>This function returns immediately after adding an operator to the engine. Subsequent attempts to read from the <code>out</code> variable will be blocked until the pull operation completes.</p>
<p><code>pull</code> is executed asynchronously after all previous <code>pull</code> calls and only the last <code>push</code> call for the same input key(s) are finished.</p>
<p>The returned values are guaranteed to be the latest values in the store.</p>
<p>See <a href="./#MXNet.mx.pull!-Tuple{KVStore,Int64,NDArray}"><code>pull!</code></a> for more examples.</p>
<p><a class="documenter-source" href="https://github.com/apache/incubator-mxnet/blob/c9818480680f84daa6e281a974ab263691302ba8/julia/src/kvstore.jl#L189-L202" target="_blank">source</a><br/></p>
<p><a href="#MXNet.mx.setoptimizer!-Tuple{KVStore,AbstractOptimizer}" id="MXNet.mx.setoptimizer!-Tuple{KVStore,AbstractOptimizer}">#</a>
<strong><code>MXNet.mx.setoptimizer!</code></strong> — <em>Method</em>.</p>
<pre><code>setoptimizer!(kv::KVStore, opt)
</code></pre>
<p>Registers an optimizer with the kvstore.</p>
<p>When using a single machine, this function updates the local optimizer. If using multiple machines and this operation is invoked from a worker node, it will serialized the optimizer with pickle and send it to all servers. The function returns after all servers have been updated.</p>
<pre><code class="julia-repl">julia&gt; kv = KVStore()
mx.KVStore @ local

julia&gt; W = mx.zeros(2, 3)  # 2×3 weight matrix
2×3 mx.NDArray{Float32,2} @ CPU0:
 0.0  0.0  0.0
 0.0  0.0  0.0

julia&gt; init!(kv, 42, W)

julia&gt; setoptimizer!(kv, SGD(η = .2))  # SGD with .2 as learning rate

julia&gt; ∇W = mx.ones(2, 3)  # assume it's the gradient
2×3 mx.NDArray{Float32,2} @ CPU0:
 1.0  1.0  1.0
 1.0  1.0  1.0

julia&gt; push!(kv, 42, ∇W)

julia&gt; pull!(kv, 42, W)  # fetch weight and write back to `W`

julia&gt; W
2×3 mx.NDArray{Float32,2} @ CPU0:
 -0.2  -0.2  -0.2
 -0.2  -0.2  -0.2
</code></pre>
<p><a class="documenter-source" href="https://github.com/apache/incubator-mxnet/blob/c9818480680f84daa6e281a974ab263691302ba8/julia/src/kvstore.jl#L300-L337" target="_blank">source</a><br/></p>
<p><a href="#MXNet.mx.setupdater!-Tuple{KVStore,Any}" id="MXNet.mx.setupdater!-Tuple{KVStore,Any}">#</a>
<strong><code>MXNet.mx.setupdater!</code></strong> — <em>Method</em>.</p>
<pre><code>setupdater!(kv, updater)
</code></pre>
<p>Sets a <code>push!</code> updater into the store.</p>
<p>This function only changes the local store. When running on multiple machines one must use <code>set_optimizer</code>.</p>
<pre><code class="julia-repl">julia&gt; update(key, val, orig) = mx.@inplace orig += val .* .2
update (generic function with 1 method)

julia&gt; kv = KVStore(:local)
mx.KVStore @ local

julia&gt; mx.setupdater!(kv, update)

julia&gt; init!(kv, 42, mx.ones(2, 3))

julia&gt; push!(kv, 42, mx.ones(2, 3))

julia&gt; x = NDArray(undef, 2, 3);

julia&gt; pull!(kv, 42, x)

julia&gt; x
2×3 mx.NDArray{Float32,2} @ CPU0:
 1.2  1.2  1.2
 1.2  1.2  1.2
</code></pre>
<p><a class="documenter-source" href="https://github.com/apache/incubator-mxnet/blob/c9818480680f84daa6e281a974ab263691302ba8/julia/src/kvstore.jl#L261-L291" target="_blank">source</a><br/></p>
<p><a href="#Base.push!-Tuple{KVStore,Int64,NDArray}" id="Base.push!-Tuple{KVStore,Int64,NDArray}">#</a>
<strong><code>Base.push!</code></strong> — <em>Method</em>.</p>
<pre><code>push!(kv::KVStore, key,  val;  priority = 0)
push!(kv::KVStore, key,  vals; priority = 0)
push!(kv::KVStore, keys, vals; priority = 0)
</code></pre>
<p>Pushes a single or a sequence of key-value pairs into the store.</p>
<p>This function returns immediately after adding an operator to the engine. The actual operation is executed asynchronously. If there are consecutive pushes to the same key, there is no guarantee on the serialization of pushes. The execution of a push does not guarantee that all previous pushes are finished. There is no synchronization between workers by default. One can use $barrier()$ to sync all workers.</p>
<p><code>push!</code> and <code>pull!</code> single <code>NDArray</code>:</p>
<pre><code class="julia-repl">julia&gt; kv = KVStore(:local)
mx.KVStore @ local

julia&gt; x = NDArray(undef, 2, 3);

julia&gt; init!(kv, 3, x)

julia&gt; push!(kv, 3, mx.ones(2, 3) * 8)

julia&gt; pull!(kv, 3, x)

julia&gt; x
2×3 mx.NDArray{Float32,2} @ CPU0:
 8.0  8.0  8.0
 8.0  8.0  8.0
</code></pre>
<p>Aggregate values and <code>push!</code>:</p>
<pre><code class="julia-repl">julia&gt; vals = [mx.ones((2, 3), gpu(0)) * 3, mx.ones((2, 3), gpu(1)) * 4];

julia&gt; push!(kv, 3, vals)

julia&gt; pull!(kv, 3, x)

julia&gt; x
2×3 mx.NDArray{Float32,2} @ CPU0:
 7.0  7.0  7.0
 7.0  7.0  7.0
</code></pre>
<p><code>push!</code> a list of key to single device:</p>
<pre><code class="julia-repl">julia&gt; keys = [4, 5];

julia&gt; init!(kv, keys, [NDArray(undef, 2, 3), NDArray(undef, 2, 3)])

julia&gt; push!(kv, keys, [x, x])

julia&gt; y, z = NDArray(undef, 2, 3), NDArray(undef, 2, 3);

julia&gt; pull!(kv, keys, [y, z])
</code></pre>
<p><a class="documenter-source" href="https://github.com/apache/incubator-mxnet/blob/c9818480680f84daa6e281a974ab263691302ba8/julia/src/kvstore.jl#L112-L172" target="_blank">source</a><br/></p>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
</div>
</div>
</div>
</footer>
</div>
<script src="../../assets/javascripts/application.c648116f.js"></script>
<script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
<script src="../../assets/mathjaxhelper.js"></script>
</body>
</html>